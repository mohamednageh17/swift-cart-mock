import { localFaker as faker, safeFakerReturn } from '../../libs/faker';
import { IsEmpty, fromSafeString, objectFromSafeString } from '../utils';
export const FakerWrapper = {
    faker: function (...args) {
        var _a, _b, _c, _d, _e;
        const hbsOptions = args[args.length - 1];
        let fakerName;
        if (args.length === 1) {
            fakerName = '';
        }
        else {
            fakerName = fromSafeString(args[0]);
        }
        if (typeof fakerName !== 'string') {
            throw new Error(`Faker method name must be a string (valid: "location.zipCode", "date.past", etc) line ${(_b = (_a = hbsOptions.loc) === null || _a === void 0 ? void 0 : _a.start) === null || _b === void 0 ? void 0 : _b.line}`);
        }
        const [fakerPrimaryMethod, fakerSecondaryMethod] = fakerName.split('.');
        let errorMessage = `${fakerName} is not a valid Faker method`;
        // check faker helper name pattern
        if (!/^[a-z]+\.[a-z0-9]+$/i.exec(fakerName) ||
            !fakerPrimaryMethod ||
            !fakerSecondaryMethod ||
            !((_c = faker[fakerPrimaryMethod]) === null || _c === void 0 ? void 0 : _c[fakerSecondaryMethod])) {
            if (!fakerName) {
                errorMessage = 'Faker method name is missing';
            }
            throw new Error(`${errorMessage} (valid: "location.zipCode", "date.past", etc) line ${(_e = (_d = hbsOptions.loc) === null || _d === void 0 ? void 0 : _d.start) === null || _e === void 0 ? void 0 : _e.line}`);
        }
        const fakerFunction = faker[fakerPrimaryMethod][fakerSecondaryMethod];
        const fakerArgsRaw = args.slice(1, args.length - 1);
        const fakerArgs = [];
        fakerArgsRaw.forEach((arg) => {
            if (typeof arg === 'string' && arg.startsWith('{') && arg.endsWith('}')) {
                const objectArg = objectFromSafeString(arg);
                if (objectArg === null) {
                    throw new Error(`Error in parsing object argument ${arg}`);
                }
                else {
                    fakerArgs.push(objectArg);
                }
            }
            else {
                fakerArgs.push(arg);
            }
        });
        // push hbs named parameters (https://handlebarsjs.com/guide/block-helpers.html#hash-arguments) to Faker
        if (!IsEmpty(hbsOptions.hash)) {
            fakerArgs.push(hbsOptions.hash);
        }
        return safeFakerReturn(() => fakerFunction(...fakerArgs));
    }
};
//# sourceMappingURL=faker-wrapper.js.map